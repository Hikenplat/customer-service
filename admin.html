<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard â€¢ HSBC Dispute Portal</title>
  <link rel="stylesheet" href="styles/main.css" />
  <style>
    /* Minimal admin styles leveraging existing main.css */
    .admin-container { 
      max-width: 1400px; 
      margin: 2rem auto; 
      padding: 0 1rem;
      margin-left: 250px;
      margin-right: 250px;
    }
    
    @media (max-width: 1400px) {
      .admin-container {
        margin-left: 150px;
        margin-right: 150px;
      }
    }
    
    @media (max-width: 1024px) {
      .admin-container {
        margin-left: 50px;
        margin-right: 50px;
      }
    }
    
    @media (max-width: 768px) {
      .admin-container {
        margin-left: 20px;
        margin-right: 20px;
      }
    }
    .card { background: #fff; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.06); padding: 1.25rem; margin-bottom: 1rem; }
    .tabs { display: flex; gap: .5rem; flex-wrap: wrap; margin-bottom: 1rem; }
    .tab-btn { padding: .6rem .9rem; border-radius: 8px; border: 1px solid #eee; background: #f9fafb; cursor: pointer; }
    .tab-btn.active { background: #111827; color: #fff; border-color: #111827; }
    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 1rem; }
    .col-4 { grid-column: span 4; }
    .col-8 { grid-column: span 8; }
    .hidden { display: none !important; }
    .muted { color: #6b7280; font-size: .9rem; }
    table { width: 100%; border-collapse: collapse; }
    th, td { text-align: left; padding: .6rem .5rem; border-bottom: 1px solid #eee; }
    th { background: #f8fafc; font-weight: 600; }
    .form-row { display: flex; gap: .75rem; flex-wrap: wrap; }
    .form-row > * { flex: 1 1 250px; }
    .email-config-card { background: #f9fafb; margin-bottom: 1rem; }
    .email-config-layout { display: flex; flex-wrap: wrap; gap: 1rem; justify-content: space-between; align-items: flex-start; }
    .email-config-layout h3 { margin-bottom: 0.35rem; }
    .email-config-last-checked { font-size: 0.85rem; display: none; }
    .email-config-meta { min-width: 220px; font-size: 0.9rem; }
    .email-config-actions { margin-top: 0.75rem; gap: 0.75rem; align-items: flex-end; }
    .email-config-test-form { flex: 1; gap: 0.5rem; }
    .email-config-error { display: none; margin-top: 0.5rem; }
    .sr-only { border: 0; clip: rect(0 0 0 0); height: 1px; margin: -1px; overflow: hidden; padding: 0; position: absolute; width: 1px; }
  .right { display: flex; justify-content: flex-end; gap: .5rem; }
  .admin-toast { position: fixed; right: 1rem; bottom: 1rem; display: none; z-index: 9999; }
  </style>
  <link rel="icon" href="data:," />
  <meta name="robots" content="noindex,nofollow" />
  <meta http-equiv="Cache-Control" content="no-store" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <script src="scripts/env-config.js"></script>
  <script src="scripts/headerNav.js"></script>
  <script defer src="scripts/api-client.js?v=20251029-1"></script>
  <script defer src="scripts/chatSession.js?v=20251029-1"></script>
  <script defer src="scripts/chatPanel.js?v=20251029-1"></script>
  <script defer src="scripts/admin.js?v=20251029-1"></script>
  <script>
    // Prevent caching during dev
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(regs => regs.forEach(r => r.unregister()));
    }
    window.addEventListener('error', function(e){
      console.error('Admin page error:', e.message, 'at', e.filename+':'+e.lineno+':'+e.colno);
      const el = document.getElementById('loginError');
      if (el && e && e.message) {
        el.textContent = 'Error: ' + e.message + (e.filename ? ' ('+e.filename+')' : '');
        el.setAttribute('style','display:block; color:#b91c1c;');
      }
    });
  </script>
  <link rel="preconnect" href="http://localhost:5000" />
  <link rel="preconnect" href="http://localhost:8080" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' http://localhost:8080 http://localhost:5000; connect-src 'self' http://localhost:5000 ws://localhost:5000; img-src 'self' data: blob:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' http://localhost:8080;" />
  <meta name="referrer" content="no-referrer" />
  <meta name="color-scheme" content="light" />
  <meta name="theme-color" content="#111827" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Admin Dashboard" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="application-name" content="Dispute Admin" />
  <meta name="msapplication-TileColor" content="#111827" />
  <meta name="msapplication-tap-highlight" content="no" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="Admin dashboard for HSBC Dispute Portal" />
  <meta name="author" content="" />
  <meta property="og:title" content="HSBC Dispute Admin" />
  <meta property="og:description" content="Admin dashboard for HSBC Dispute Portal" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="http://localhost:8080/admin.html" />
  <meta property="og:site_name" content="HSBC Dispute Portal" />
</head>
<body>
  <header class="header" role="banner">
    <div class="header-top-container">
      <div class="header-top">
        <div class="container">
          <nav aria-label="product line">
            <ul class="header-top-navigation">
              <li class="header-top-navigation-item">
                <a href="/personal">
                  Personal
                </a>
              </li>
              <li class="header-top-navigation-item">
                <a href="/private">
                  Private
                </a>
              </li>
              <li class="header-top-navigation-item">
                <a href="/business">
                  Business
                </a>
              </li>
              <li class="header-top-navigation-item">
                <a href="/corporate">
                  Corporate
                </a>
              </li>
            </ul>
          </nav>
          <div class="header-top-meta">
            <div class="header-user-wrapper">
              <a class="register-button" href="/register" role="button">
                Register
              </a>
              <a class="login-button" href="#loginSection" role="button">
                Log on
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="header-main-container">
      <div class="header-main">
        <div class="container">
          <!-- Mobile Menu Toggle (Left) -->
          <button class="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
            <span></span>
            <span></span>
            <span></span>
          </button>

          <div class="header-logo">
            <h1>
              <a href="/" class="header-logo-link">
                <img src="/scripts/public/hsbc_logo.png" alt="HSBC Logo" width="60" height="60">
                <span><strong>HSBC</strong> UK</span>
              </a>
            </h1>
          </div>

          <!-- Mobile Login Button (Right) -->
          <div class="mobile-header-actions">
            <button id="mobileLogoutBtn" class="mobile-login-button hidden">Logout</button>
          </div>

          <nav class="header-main-navigation" aria-label="main navigation">
            <ul>
              <li class="header-main-navigation-item">
                <a href="/">
                  <span class="header-main-navigation-title">Home</span>
                  <span class="header-main-navigation-subtitle">Welcome</span>
                </a>
              </li>
              <li class="header-main-navigation-item">
                <a href="/submit">
                  <span class="header-main-navigation-title">Submit Dispute</span>
                  <span class="header-main-navigation-subtitle">New claim</span>
                </a>
              </li>
              <li class="header-main-navigation-item">
                <a href="/track">
                  <span class="header-main-navigation-title">Track</span>
                  <span class="header-main-navigation-subtitle">Check status</span>
                </a>
              </li>
              <li class="header-main-navigation-item active">
                <a href="/admin" aria-current="page">
                  <span class="header-main-navigation-title">Admin</span>
                  <span class="header-main-navigation-subtitle">Dashboard</span>
                </a>
              </li>
            </ul>
          </nav>
          <button id="logoutBtn" class="btn btn-secondary btn-small hidden">Logout</button>
        </div>
      </div>
    </div>
  </header>

  <main class="admin-container">
    <!-- Login Card -->
    <section id="loginSection" class="card">
      <h2>Admin Login</h2>
      <p class="muted">Use your admin credentials to access the dashboard.</p>
      <form id="loginForm" class="form">
        <div class="form-row">
          <div class="form-field">
            <label for="adminEmail">Email</label>
            <input type="email" id="adminEmail" required placeholder="admin@disputeportal.com" />
          </div>
          <div class="form-field">
            <label for="adminPassword">Password</label>
            <input type="password" id="adminPassword" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
          </div>
        </div>
        <div class="right">
          <button type="submit" class="btn btn-primary">Sign In</button>
        </div>
        <p id="loginError" class="muted" style="color:#b91c1c; display:none;"></p>
      </form>
    </section>

    <!-- Dashboard -->
    <section id="dashboardSection" class="hidden">
      <div class="card">
        <div class="grid">
          <div class="col-8">
            <div class="tabs">
              <button class="tab-btn active" data-tab="disputesTab">Disputes</button>
              <button class="tab-btn" data-tab="emailsTab">Email Templates</button>
              <button class="tab-btn" data-tab="threadsTab">Email Threads</button>
              <button class="tab-btn" data-tab="chatTab">Chat Sessions</button>
              <button class="tab-btn" data-tab="statsTab">Stats</button>
            </div>
          </div>
          <div class="col-4 right">
            <span id="userBadge" class="muted">Signed in</span>
          </div>
        </div>
      </div>

      <!-- Disputes Tab -->
      <div id="disputesTab" class="card">
        <div class="form-row" style="margin-bottom:.5rem;">
          <select id="filterStatus">
            <option value="">All Statuses</option>
            <option value="new">New</option>
            <option value="pending">Pending</option>
            <option value="in_review">In Review</option>
            <option value="resolved">Resolved</option>
            <option value="rejected">Rejected</option>
          </select>
          <input type="text" id="filterSearch" placeholder="Search by email or reference..." />
          <button id="refreshDisputes" class="btn btn-secondary">Refresh</button>
        </div>
        <table>
          <thead>
            <tr>
              <th>Ref</th>
              <th>Customer</th>
              <th>Email</th>
              <th>Status</th>
              <th>Amount</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="disputesTableBody"></tbody>
        </table>
        
        <!-- Dispute Detail Panel (hidden initially) -->
        <div id="disputeDetail" class="card hidden" style="margin-top:1rem; border: 2px solid #e5e7eb;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
            <h3 id="disputeDetailTitle">Dispute Details</h3>
            <button id="closeDisputeDetail" class="btn btn-secondary btn-small">Ã—</button>
          </div>
          
          <div class="grid">
            <!-- Customer Info Column -->
            <div class="col-6">
              <div class="card" style="background: #f9fafb;">
                <h4 style="margin-bottom:0.75rem;">Customer Information</h4>
                <div style="font-size:0.9rem;">
                  <p><strong>Name:</strong> <span id="detailCustomerName">-</span></p>
                  <p><strong>Email:</strong> <span id="detailCustomerEmail">-</span></p>
                  <p><strong>Phone:</strong> <span id="detailCustomerPhone">-</span></p>
                </div>
              </div>
            </div>
            
            <!-- Transaction Info Column -->
            <div class="col-6">
              <div class="card" style="background: #f9fafb;">
                <h4 style="margin-bottom:0.75rem;">Transaction Information</h4>
                <div style="font-size:0.9rem;">
                  <p><strong>Amount:</strong> <span id="detailAmount">-</span></p>
                  <p><strong>Currency:</strong> <span id="detailCurrency">-</span></p>
                  <p><strong>Date:</strong> <span id="detailTransactionDate">-</span></p>
                  <p><strong>Role:</strong> <span id="detailRole">-</span></p>
                  <p><strong>Auth Status:</strong> <span id="detailAuthStatus">-</span></p>
                </div>
              </div>
            </div>
          </div>

          <!-- Dispute Description -->
          <div class="card" style="background: #f9fafb; margin-top:1rem;">
            <h4 style="margin-bottom:0.5rem;">Description</h4>
            <p id="detailDescription" style="white-space: pre-wrap; font-size:0.9rem;">-</p>
          </div>

          <!-- Attachments -->
          <div class="card" style="background: #f9fafb; margin-top:1rem;">
            <h4 style="margin-bottom:0.5rem;">Attachments</h4>
            <div id="detailAttachments" style="font-size:0.9rem;"></div>
          </div>

          <!-- Status & Actions -->
          <div class="card" style="margin-top:1rem;">
            <h4 style="margin-bottom:0.75rem;">Status & Actions</h4>
            <div class="form-row">
              <select id="updateDisputeStatus">
                <option value="pending">Pending</option>
                <option value="in_review">In Review</option>
                <option value="resolved">Resolved</option>
                <option value="rejected">Rejected</option>
              </select>
              <select id="updateDisputePriority">
                <option value="low">Low Priority</option>
                <option value="medium">Medium Priority</option>
                <option value="high">High Priority</option>
                <option value="urgent">Urgent</option>
              </select>
              <button id="saveDisputeChanges" class="btn btn-primary">Save Changes</button>
            </div>
            <div class="form-field" style="margin-top:0.75rem;">
              <label for="disputeResolution">Resolution Notes</label>
              <textarea id="disputeResolution" rows="3" placeholder="Enter resolution details..."></textarea>
            </div>
          </div>

          <!-- Linked Resources -->
          <div class="grid" style="margin-top:1rem;">
            <div class="col-6">
              <div class="card" style="background: #eff6ff;">
                <h4 style="margin-bottom:0.5rem;">ðŸ“§ Email Thread</h4>
                <p id="detailEmailThread" style="font-size:0.9rem;">-</p>
                <button id="viewEmailThread" class="btn btn-secondary btn-small" style="margin-top:0.5rem;">View Thread</button>
              </div>
            </div>
            <div class="col-6">
              <div class="card" style="background: #f0fdf4;">
                <h4 style="margin-bottom:0.5rem;">ðŸ’¬ Chat Session</h4>
                <p id="detailChatSession" style="font-size:0.9rem;">-</p>
                <button id="viewChatSession" class="btn btn-secondary btn-small" style="margin-top:0.5rem;">View Chat</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Email Templates Tab -->
      <div id="emailsTab" class="card hidden">
        <div id="emailConfigPanel" class="card email-config-card">
          <div class="email-config-layout">
            <div>
              <h3>Email Service</h3>
              <p id="emailConfigStatus" class="muted">Checking configurationâ€¦</p>
              <p id="emailConfigLastChecked" class="muted email-config-last-checked"></p>
            </div>
            <div class="email-config-meta">
              <p><strong>Provider:</strong> <span id="emailConfigProvider">-</span></p>
              <p><strong>From:</strong> <span id="emailConfigFrom">-</span></p>
              <p><strong>SMTP Host:</strong> <span id="emailConfigHost">-</span></p>
              <p><strong>Security:</strong> <span id="emailConfigSecure">-</span></p>
            </div>
          </div>
          <div class="form-row email-config-actions">
            <button type="button" id="testEmailConnection" class="btn btn-secondary">Test Connection</button>
            <form id="testEmailForm" class="form-row email-config-test-form">
              <label for="testEmailRecipient" class="sr-only">Test email recipient</label>
              <input type="email" id="testEmailRecipient" placeholder="test@recipient.com" required autocomplete="email" />
              <button type="submit" class="btn btn-primary" id="sendTestEmailBtn">Send Test Email</button>
            </form>
          </div>
          <p id="emailConfigError" class="muted email-config-error"></p>
        </div>

        <h3>Templates</h3>
        <div id="templatesList"></div>
        <hr />
        <h4>Create Template</h4>
        <form id="templateForm">
          <div class="form-row">
            <input type="text" id="tplName" placeholder="Name (e.g. dispute_acknowledgement)" required />
            <input type="text" id="tplSubject" placeholder="Subject" required />
          </div>
          <div class="form-field">
            <textarea id="tplBody" rows="4" placeholder="Body with {{placeholders}}" required></textarea>
          </div>
          <div class="right"><button class="btn btn-primary" type="submit">Save Template</button></div>
        </form>
      </div>

      <!-- Email Threads Tab -->
      <div id="threadsTab" class="card hidden">
        <div class="form-row" style="margin-bottom:.5rem;">
          <input type="text" id="threadsSearch" placeholder="Search by subject or email" />
          <button id="refreshThreads" class="btn btn-secondary">Refresh</button>
        </div>
        <table>
          <thead><tr><th>Subject</th><th>From</th><th>Status</th><th>Dispute Link</th><th>Updated</th><th>Messages</th></tr></thead>
          <tbody id="threadsTableBody"></tbody>
        </table>
        
        <!-- Email Thread Detail Panel (hidden initially) -->
        <div id="emailThreadDetail" class="card hidden" style="margin-top:1rem; border: 2px solid #8b5cf6;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
            <div>
              <h3 id="emailThreadDetailTitle">Email Thread</h3>
              <p class="muted" id="emailThreadDetailSubject" style="margin:0; font-size:0.9rem;"></p>
            </div>
            <div>
              <select id="updateThreadStatus" style="margin-right:0.5rem;">
                <option value="open">Open</option>
                <option value="pending">Pending</option>
                <option value="resolved">Resolved</option>
                <option value="closed">Closed</option>
              </select>
              <button id="saveThreadStatus" class="btn btn-primary btn-small" style="margin-right:0.5rem;">Save Status</button>
              <button id="closeEmailThreadDetail" class="btn btn-secondary btn-small">Ã—</button>
            </div>
          </div>
          
          <!-- Thread Info -->
          <div class="grid" style="margin-bottom:1rem;">
            <div class="col-6">
              <div class="card" style="background: #f9fafb;">
                <p style="margin:0; font-size:0.9rem;"><strong>Customer:</strong> <span id="threadCustomerName">-</span></p>
                <p style="margin:0.25rem 0 0 0; font-size:0.9rem;"><strong>Email:</strong> <span id="threadCustomerEmail">-</span></p>
              </div>
            </div>
            <div class="col-6">
              <div class="card" style="background: #f9fafb;">
                <p style="margin:0; font-size:0.9rem;"><strong>Status:</strong> <span id="threadStatus">-</span></p>
                <p style="margin:0.25rem 0 0 0; font-size:0.9rem;"><strong>Created:</strong> <span id="threadCreated">-</span></p>
              </div>
            </div>
          </div>

          <!-- Email Messages Container -->
          <div style="background:#f9fafb; border-radius:8px; padding:1rem; max-height:500px; overflow-y:auto; margin-bottom:1rem;">
            <h4 style="margin-top:0;">Conversation</h4>
            <div id="emailMessagesContainer" style="display:flex; flex-direction:column; gap:1rem;"></div>
            <p id="noEmailMessages" class="muted hidden" style="text-align:center; padding:2rem;">No messages in this thread yet.</p>
          </div>

          <!-- Reply Form -->
          <div class="card" style="background:#eff6ff;">
            <h4 style="margin-top:0;">Send Reply</h4>
            <div class="form-field">
              <label for="replyBody">Message</label>
              <textarea id="replyBody" rows="4" placeholder="Type your reply here..."></textarea>
            </div>
            <div class="right">
              <button id="sendEmailReply" class="btn btn-primary">Send Reply</button>
            </div>
          </div>
          
          <!-- Link to Dispute -->
          <div id="threadDisputeLink" class="card hidden" style="background:#fef3c7; margin-top:1rem;">
            <p style="margin:0; font-size:0.9rem;">
              <strong>ðŸ“„ Linked Dispute:</strong> 
              <span id="linkedDisputeRef">-</span>
              <button id="viewLinkedDispute" class="btn btn-secondary btn-small" style="margin-left:0.5rem;">View Dispute</button>
            </p>
          </div>
        </div>
      </div>

      <!-- Chat Tab -->
      <div id="chatTab" class="card hidden">
        <div class="form-row" style="margin-bottom:.5rem;">
          <select id="chatFilter">
            <option value="">All</option>
            <option value="open">Open</option>
            <option value="closed">Closed</option>
          </select>
          <button id="refreshChats" class="btn btn-secondary">Refresh</button>
        </div>
        <table>
          <thead><tr><th>Session</th><th>User</th><th>Status</th><th>Updated</th></tr></thead>
          <tbody id="chatTableBody"></tbody>
        </table>
        <div id="chatDetail" class="card hidden" style="margin-top:1rem;">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <h4>Chat Detail</h4>
            <div>
              <button id="joinChatBtn" class="btn btn-secondary btn-small">Join</button>
              <button id="closeChatBtn" class="btn btn-secondary btn-small">Close</button>
              <button id="emailTranscriptBtn" class="btn btn-primary btn-small">Send Transcript</button>
            </div>
          </div>
          <div id="chatMessagesAdmin" style="max-height:280px; overflow:auto; padding:.5rem; background:#f9fafb; border-radius:8px; margin-top:.5rem;"></div>
          <div class="form-row" style="margin-top:.5rem;">
            <input type="text" id="adminReplyInput" placeholder="Type a reply..." />
            <button id="sendAdminReply" class="btn btn-primary btn-small">Send</button>
          </div>
        </div>
      </div>

      <!-- Stats Tab -->
      <div id="statsTab" class="card hidden">
        <h3>Dashboard Statistics</h3>
        <div id="statsContent" class="grid">
          <div class="col-4"><div class="card"><h4>Total Disputes</h4><div id="statTotalDisputes" style="font-size:2rem;font-weight:bold;color:#111827;">-</div></div></div>
          <div class="col-4"><div class="card"><h4>Open Disputes</h4><div id="statOpenDisputes" style="font-size:2rem;font-weight:bold;color:#f59e0b;">-</div></div></div>
          <div class="col-4"><div class="card"><h4>Closed Disputes</h4><div id="statResolvedDisputes" style="font-size:2rem;font-weight:bold;color:#10b981;">-</div></div></div>
        </div>
        <div class="grid" style="margin-top:1rem;">
          <div class="col-4"><div class="card"><h4>Active Chats</h4><div id="statActiveChats" style="font-size:2rem;font-weight:bold;color:#3b82f6;">-</div></div></div>
          <div class="col-4"><div class="card"><h4>Open Email Threads</h4><div id="statOpenThreads" style="font-size:2rem;font-weight:bold;color:#8b5cf6;">-</div></div></div>
          <div class="col-4"><div class="card"><h4>Closed Email Threads</h4><div id="statClosedThreads" style="font-size:2rem;font-weight:bold;color:#6b7280;">-</div></div></div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="footer-main">
      <div class="container">
        <div class="footer-grid">
          <div class="footer-column">
            <div class="footer-title">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
              <h3>Help & Support</h3>
            </div>
            <p>Manage dispute cases with access to real-time data</p>
          </div>

          <div class="footer-column">
            <div class="footer-title">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
              <h3>Operations</h3>
            </div>
            <p>Monitor disputed transactions across all business channels</p>
          </div>

          <div class="footer-column">
            <div class="footer-title">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
              <h3>Compliance</h3>
            </div>
            <p>Ensure regulatory oversight and audit-ready reporting</p>
          </div>

          <div class="footer-column">
            <div class="footer-title">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
              <h3>About HSBC</h3>
            </div>
            <p>HSBC UK Bank plc. Registered in England and Wales.</p>
          </div>
        </div>
      </div>
    </div>

    <div class="footer-bottom">
      <div class="container">
        <nav aria-label="Footer navigation">
          <ul class="footer-links">
            <li><a href="/">Home</a></li>
            <li><a href="/track">Track Disputes</a></li>
            <li><a href="/submit">Submit Dispute</a></li>
            <li><a href="#" id="scrollTop">Back to top</a></li>
          </ul>
        </nav>
        <div class="footer-legal">
          <p>&copy; Copyright HSBC UK 2025. All rights reserved</p>
          <p>Authorised by the Prudential Regulation Authority and regulated by the Financial Conduct Authority.</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Floating Chat Button -->
  <div class="floating-chat-widget">
    <div class="chat-prompt">Hi, Need Help?<br><span class="chat-subtext">We're here if you need us</span></div>
    <button class="floating-chat-btn" aria-label="Open live chat" title="Chat with us">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
      </svg>
      <span class="chat-text">Chat</span>
    </button>
  </div>

  <!-- Toast notifications -->
  <div id="toast" class="admin-toast"></div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const chatButton = document.querySelector('.floating-chat-btn');
      const chatPrompt = document.querySelector('.chat-prompt');
      const sessionManager = window.chatSessionManager;

      if (!chatButton || !sessionManager) {
        return;
      }

      if (sessionManager.hasActiveSession() && chatPrompt) {
        chatPrompt.innerHTML = 'Resume Chat<br><span class="chat-subtext">Continue your conversation</span>';
      }

      chatButton.addEventListener('click', function () {
        window.location.href = 'index.html#chat';
      });
    });
  </script>
</body>
</html>
