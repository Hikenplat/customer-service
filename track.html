<!DOCTYPE html>
<html lang="en-gb" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Track Your Dispute â€¢ HSBC UK Payment Dispute Portal</title>
    <meta name="description" content="Track your payment dispute status with HSBC UK. Check the progress of your claim using your reference number.">
    
    <link rel="icon" type="image/png" href="/content/dam/hsbc/gb/images/logos/favicon-32x32.png" sizes="32x32">
    <link rel="stylesheet" href="styles/main.css">
    <style>
        /* Track page specific styles */
        main {
            padding-top: 2rem;
        }
        
        .track-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        .track-card {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            padding: 2.5rem;
        }
        .track-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .track-header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: #111827;
        }
        .track-header p {
            color: #6b7280;
            font-size: 1rem;
        }
        .track-form {
            margin-bottom: 2rem;
        }
        .track-result {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .status-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
        }
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        .status-in_review {
            background: #dbeafe;
            color: #1e40af;
        }
        .status-resolved {
            background: #d1fae5;
            color: #065f46;
        }
        .status-rejected {
            background: #fee2e2;
            color: #991b1b;
        }
        .info-grid {
            display: grid;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        .info-item {
            padding: 1rem;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 4px solid #B8102E;
        }
        .info-label {
            font-size: 0.85rem;
            color: #6b7280;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .info-value {
            font-size: 1.1rem;
            color: #111827;
            font-weight: 500;
        }
        .track-again {
            text-align: center;
            margin-top: 2rem;
        }
        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            display: none;
        }
        .loading {
            text-align: center;
            padding: 2rem;
            display: none;
        }
        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #B8102E;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        .track-submit-btn {
            width: 100%;
            margin-top: 1rem;
        }
        .track-loading-text {
            margin-top: 1rem;
            color: #6b7280;
        }
        .track-result-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .track-result-header h2 {
            margin-bottom: 0.5rem;
        }
        .track-result-header p {
            color: #6b7280;
        }
        .track-status-wrapper {
            text-align: center;
            margin-bottom: 2rem;
        }
        .track-status-wrapper .status-badge {
            margin-top: 0.5rem;
        }
        .resolution-info {
            display: none;
            grid-column: 1 / -1;
            border-left-color: #10b981;
        }
        .track-form-help {
            color: #6b7280;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header" role="banner">
        <div class="header-top-container">
            <div class="header-top">
                <div class="container">
                    <nav aria-label="product line">
                        <ul class="header-top-navigation">
                            <li class="header-top-navigation-item">
                                <a href="/personal">
                                    Personal
                                </a>
                            </li>
                            <li class="header-top-navigation-item">
                                <a href="/private">
                                    Private
                                </a>
                            </li>
                            <li class="header-top-navigation-item">
                                <a href="/business">
                                    Business
                                </a>
                            </li>
                            <li class="header-top-navigation-item">
                                <a href="/corporate">
                                    Corporate
                                </a>
                            </li>
                        </ul>
                    </nav>
                    <div class="header-top-meta">
                        <div class="header-user-wrapper">
                            <a class="register-button" href="#register" role="button">
                                Register
                            </a>
                            <a class="login-button" href="/admin" role="button">
                                Log on
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="header-main-container">
            <div class="header-main">
                <div class="container">
                    <!-- Mobile Menu Toggle (Left) -->
                    <button class="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>

                    <div class="header-logo">
                        <h1>
                            <img src="/scripts/public/hsbc_logo.png" alt="HSBC Logo" width="60" height="60">
                            <span><strong>HSBC</strong> UK</span>
                        </h1>
                    </div>

                    <!-- Mobile Login Button (Right) -->
                    <div class="mobile-header-actions">
                        <a class="mobile-login-button" href="/admin" role="button">
                            Log on
                        </a>
                    </div>

                    <nav class="header-main-navigation" aria-label="main navigation">
                        <ul>
                            <li class="header-main-navigation-item">
                                <a href="/">
                                    <span class="header-main-navigation-title">Home</span>
                                    <span class="header-main-navigation-subtitle">Welcome</span>
                                </a>
                            </li>
                            <li class="header-main-navigation-item">
                                <a href="/submit">
                                    <span class="header-main-navigation-title">Submit Dispute</span>
                                    <span class="header-main-navigation-subtitle">New claim</span>
                                </a>
                            </li>
                            <li class="header-main-navigation-item active">
                                <a href="/track" aria-current="page">
                                    <span class="header-main-navigation-title">Track</span>
                                    <span class="header-main-navigation-subtitle">Check status</span>
                                </a>
                            </li>
                            <li class="header-main-navigation-item">
                                <a href="/admin">
                                    <span class="header-main-navigation-title">Admin</span>
                                    <span class="header-main-navigation-subtitle">Dashboard</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="track-container">
            <div class="track-card">
            <div class="track-header">
                <h1>Track Your Dispute</h1>
                <p>Enter your reference number and email to check the status of your dispute</p>
            </div>

            <!-- Track Form -->
            <form id="trackForm" class="track-form">
                <div class="form-field">
                    <label for="referenceNumber">Reference Number</label>
                    <input 
                        type="text" 
                        id="referenceNumber" 
                        name="referenceNumber" 
                        placeholder="DSP-1234567890" 
                        required
                        pattern="DSP-\d+"
                        title="Format: DSP-1234567890"
                    />
                    <small class="track-form-help">Format: DSP-1234567890 (found in your confirmation email)</small>
                </div>

                <div class="form-field">
                    <label for="email">Email Address</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        placeholder="your@email.com" 
                        required
                    />
                    <small class="track-form-help">The email you used when submitting the dispute</small>
                </div>

                <button type="submit" class="btn btn-primary track-submit-btn">
                    Track Dispute
                </button>
            </form>

            <!-- Loading State -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p class="track-loading-text">Searching for your dispute...</p>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="error-message"></div>

            <!-- Track Result -->
            <div id="trackResult" class="track-result">
                <div class="track-result-header">
                    <h2>Dispute Found!</h2>
                    <p>Reference: <strong id="resultRef"></strong></p>
                </div>

                <div class="track-status-wrapper">
                    <div class="info-label">Current Status</div>
                    <div id="statusBadge" class="status-badge"></div>
                </div>

                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Transaction Amount</div>
                        <div class="info-value" id="resultAmount"></div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Transaction Date</div>
                        <div class="info-value" id="resultDate"></div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Priority</div>
                        <div class="info-value" id="resultPriority"></div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Submitted On</div>
                        <div class="info-value" id="resultCreated"></div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Last Updated</div>
                        <div class="info-value" id="resultUpdated"></div>
                    </div>

                    <div id="resolutionInfo" class="info-item resolution-info">
                        <div class="info-label">Resolution</div>
                        <div class="info-value" id="resultResolution"></div>
                    </div>
                </div>

                <div class="track-again">
                    <button id="trackAgainBtn" class="btn btn-secondary">
                        Track Another Dispute
                    </button>
                </div>
            </div>
        </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-main">
            <div class="container">
                <div class="footer-grid">
                    <div class="footer-column">
                        <div class="footer-title">
                            <h3>Help & Support</h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>
                        <p>Got a question? We're here to help you</p>
                    </div>

                    <div class="footer-column">
                        <div class="footer-title">
                            <h3>Branch Finder</h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>
                        <p>Find your nearest branch</p>
                    </div>

                    <div class="footer-column">
                        <div class="footer-title">
                            <h3>Our Service Performance</h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>
                        <p>View our service status to see how we're doing</p>
                    </div>

                    <div class="footer-column">
                        <div class="footer-title">
                            <h3>About HSBC</h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>
                        <p>Careers, Media, Investors and corporate information</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <div class="container">
                <nav aria-label="Footer navigation">
                    <ul class="footer-links">
                        <li><a href="#legal">Legal</a></li>
                        <li><a href="#privacy">Privacy Notice</a></li>
                        <li><a href="#cookies">Cookie Notice</a></li>
                        <li><a href="#accessibility">Accessibility</a></li>
                        <li><a href="#security">Security</a></li>
                    </ul>
                </nav>
                <div class="footer-legal">
                    <p>&copy; Copyright HSBC UK 2025. All rights reserved</p>
                    <p>HSBC UK Bank plc. Registered in England and Wales.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Floating Chat Button -->
    <div class="floating-chat-widget">
        <div class="chat-prompt">Hi, Need Help?<br><span class="chat-subtext">We're here if you need us</span></div>
        <button class="floating-chat-btn" aria-label="Open live chat" title="Chat with us">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <span class="chat-text">Chat</span>
        </button>
    </div>

    <!-- Header authentication helper -->
    <script src="scripts/api-client.js?v=20251029-1"></script>
    <!-- Socket.IO client from backend server -->
    <script src="http://localhost:5000/socket.io/socket.io.js"></script>
    <!-- Chat Session Manager -->
    <script src="scripts/chatSession.js"></script>
    <script src="scripts/headerAuth.js"></script>
    <script src="scripts/home.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const trackForm = document.getElementById('trackForm');
            const loading = document.getElementById('loading');
            const errorMessage = document.getElementById('errorMessage');
            const trackResult = document.getElementById('trackResult');
            const trackAgainBtn = document.getElementById('trackAgainBtn');

            trackForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const referenceNumber = document.getElementById('referenceNumber').value.trim();
                const email = document.getElementById('email').value.trim();

                // Hide previous results
                trackForm.style.display = 'none';
                errorMessage.style.display = 'none';
                trackResult.style.display = 'none';
                loading.style.display = 'block';

                try {
                    const response = await fetch('http://localhost:5000/api/disputes/track', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ referenceNumber, email })
                    });

                    const data = await response.json();

                    loading.style.display = 'none';

                    if (data.success && data.data) {
                        // Show result
                        displayResult(data.data);
                    } else {
                        // Show error
                        errorMessage.textContent = data.error || 'Dispute not found. Please check your reference number and email.';
                        errorMessage.style.display = 'block';
                        trackForm.style.display = 'block';
                    }
                } catch (error) {
                    loading.style.display = 'none';
                    errorMessage.textContent = 'Failed to track dispute. Please try again later.';
                    errorMessage.style.display = 'block';
                    trackForm.style.display = 'block';
                    console.error('Track error:', error);
                }
            });

            function displayResult(dispute) {
                // Populate fields
                document.getElementById('resultRef').textContent = dispute.reference_number;
                
                // Status badge
                const statusBadge = document.getElementById('statusBadge');
                const statusLabels = {
                    'pending': 'Pending Review',
                    'in_review': 'Under Investigation',
                    'resolved': 'Resolved',
                    'rejected': 'Rejected'
                };
                statusBadge.textContent = statusLabels[dispute.status] || dispute.status;
                statusBadge.className = `status-badge status-${dispute.status}`;

                // Transaction info
                document.getElementById('resultAmount').textContent = 
                    `${dispute.currency || 'USD'} ${dispute.transaction_amount?.toFixed(2) || '0.00'}`;
                document.getElementById('resultDate').textContent = 
                    dispute.transaction_date || 'N/A';
                document.getElementById('resultPriority').textContent = 
                    (dispute.priority || 'medium').charAt(0).toUpperCase() + (dispute.priority || 'medium').slice(1);
                document.getElementById('resultCreated').textContent = 
                    new Date(dispute.created_at).toLocaleString();
                document.getElementById('resultUpdated').textContent = 
                    new Date(dispute.updated_at).toLocaleString();

                // Resolution (if available)
                if (dispute.resolution) {
                    document.getElementById('resolutionInfo').style.display = 'block';
                    document.getElementById('resultResolution').textContent = dispute.resolution;
                }

                trackResult.style.display = 'block';
            }

            trackAgainBtn.addEventListener('click', () => {
                trackResult.style.display = 'none';
                trackForm.style.display = 'block';
                trackForm.reset();
            });
        });
    </script>
</body>
</html>
